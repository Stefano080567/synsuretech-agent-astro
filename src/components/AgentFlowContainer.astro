---
const steps = [
  { id: "why", title: "Why WikiSure™ Exists" },
  { id: "context", title: "Demo Context" },
  { id: "term", title: "Term Selection" },
  { id: "definition", title: "Definition" },
  { id: "validation", title: "Validation" },
  { id: "decision", title: "Decision" }
];

const currentStepId = Astro.url.searchParams.get("step") || "why";
const currentIndex = steps.findIndex(s => s.id === currentStepId);
const currentStep = steps[currentIndex];

const prevStep = steps[currentIndex - 1];
const nextStep = steps[currentIndex + 1];
---

<section class="flowContainer">
  <header class="flowHeader">
    <h1 class="flowTitle">{currentStep.title}</h1>
    <p class="flowProgress">
      Step {currentIndex + 1} of {steps.length}
    </p>
  </header>

  <!-- STEP 1 -->
  {currentStep.id === "why" && (
    <section class="stepSection">
      <p class="lead">
        Modern ecosystems move faster when meaning is clear.
        WikiSure™ makes shared understanding explicit so decisions
        can be taken with confidence.
      </p>

      <p>
        AI can support teams — but people stay in the driver’s seat.
        This demo shows one moment of that process.
      </p>
    </section>
  )}

  <!-- STEP 2 -->
  {currentStep.id === "context" && (
    <section class="stepSection">
      <div class="card">
        <p><strong>Country:</strong> Germany</p>
        <p><strong>Focus:</strong> Embedded Insurance</p>
        <p><strong>Perspective:</strong> Platform Provider</p>
      </div>

      <p class="note">
        The context is intentionally fixed to keep the story clear.
      </p>
    </section>
  )}

  <!-- STEP 3 -->
  {currentStep.id === "term" && (
    <section class="stepSection">
      <p class="lead">
        Select a term that is used by multiple parties
        and can easily be misunderstood.
      </p>

      <div class="card">
        <strong>Example term:</strong>
        <p>Embedded Insurance Consent</p>
      </div>
    </section>
  )}

  <!-- STEP 4 -->
  {currentStep.id === "definition" && (
    <section class="stepSection">
      <div class="definitionGrid">
        <div class="definitionBox">
          <span class="label">Current Definition</span>
          <p>
            User consent is obtained during the purchase process
            and allows insurance activation.
          </p>
        </div>

        <div class="definitionBox highlight">
          <span class="label">Proposed Definition</span>
          <p>
            Explicit user consent is collected at a defined point
            in the user journey and documented in a way that is
            verifiable across partners.
          </p>
        </div>
      </div>
    </section>
  )}

  <!-- STEP 5 -->
  {currentStep.id === "validation" && (
    <section class="stepSection">
      <p class="lead">
        Before a definition is applied, it is checked
        from a governance perspective.
      </p>

      <div class="card">
        <ul>
          <li>No ambiguity introduced</li>
          <li>No responsibility shift</li>
          <li>No compliance risk</li>
        </ul>

        <p class="humanNote">
          Human-in-the-loop: the system assists,
          a person owns the judgment.
        </p>
      </div>
    </section>
  )}

  <!-- STEP 6 -->
  {currentStep.id === "decision" && (
    <section class="stepSection">
      <div class="card decision">
        <span class="label">Governance Outcome</span>
        <strong class="signal pass">PASS</strong>

        <p>
          The definition is clear, implementable,
          and safe to roll out across partners.
        </p>

        <p class="humanNote">
          Final responsibility remains with a human decision-maker.
        </p>
      </div>
    </section>
  )}

  <!-- NAVIGATION -->
  <footer class="flowNav">
    {prevStep && (
      <a class="navButton secondary" href={`?step=${prevStep.id}`}>
        ← Back
      </a>
    )}

    {nextStep && (
      <a class="navButton primary" href={`?step=${nextStep.id}`}>
        Next →
      </a>
    )}
  </footer>
</section>

<style>
.flowContainer {
  max-width: 760px;
  margin: 0 auto;
  padding: 48px 20px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.flowHeader {
  margin-bottom: 32px;
}

.flowTitle {
  font-size: 28px;
  margin-bottom: 6px;
}

.flowProgress {
  color: #666;
  font-size: 14px;
}

.stepSection {
  margin-bottom: 40px;
}

.lead {
  font-size: 18px;
  margin-bottom: 20px;
}

.card {
  background: #fafafa;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
}

.definitionGrid {
  display: grid;
  gap: 24px;
}

.definitionBox {
  padding: 20px;
  border-radius: 12px;
  background: #f3f3f3;
}

.definitionBox.highlight {
  background: #eef3ff;
}

.label {
  font-size: 12px;
  color: #666;
  text-transform: uppercase;
  margin-bottom: 6px;
  display: block;
}

.signal.pass {
  color: #1a7f37;
  font-size: 18px;
}

.humanNote {
  margin-top: 12px;
  font-size: 14px;
  color: #555;
}

.flowNav {
  display: flex;
  justify-content: space-between;
  margin-top: 40px;
}

.navButton {
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  font-size: 14px;
}

.navButton.primary {
  background: #000;
  color: #fff;
}

.navButton.secondary {
  background: #eaeaea;
  color: #000;
}
</style>
